# å°åº¦å”¤é†’æ”¯ä»˜APIå¯¹æ¥æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [å‰è¨€æ¦‚è¿°](#å‰è¨€æ¦‚è¿°)
- [ç­¾åç®—æ³•](#ç­¾åç®—æ³•)
- [æ”¯ä»˜ç±»å‹](#æ”¯ä»˜ç±»å‹)
- [å­˜æ¬¾è®¢å•](#å­˜æ¬¾è®¢å•)
- [å‡ºæ¬¾è®¢å•](#å‡ºæ¬¾è®¢å•)
- [å¼‚æ­¥é€šçŸ¥](#å¼‚æ­¥é€šçŸ¥)
- [æŸ¥è¯¢æ¥å£](#æŸ¥è¯¢æ¥å£)
- [é”™è¯¯ç è¯´æ˜](#é”™è¯¯ç è¯´æ˜)
- [ç¤ºä¾‹ä»£ç ](#ç¤ºä¾‹ä»£ç )

---

## ğŸ¯ å‰è¨€æ¦‚è¿°

### æ¦‚è¦

æœ¬æ–‡æ¡£å®šä¹‰äº†æ¥å…¥å°åº¦å”¤é†’æ”¯ä»˜ç³»ç»Ÿçš„æŠ¥æ–‡æ¥å£è§„èŒƒï¼Œå…·ä½“åŒ…æ‹¬ï¼š

- **æ¥å£é€šä¿¡æ–¹å¼**ï¼šæ¶µç›–ç½‘ç»œé€šè®¯æ–¹å¼åŠæ¥å£åŠ è§£å¯†æ–¹å¼
- **ä¸šåŠ¡å¤„ç†æµç¨‹**ï¼šæ¶‰åŠä»£æ”¶ã€ä»£ä»˜ã€æµæ°´ç®¡ç†åŠè´¢åŠ¡ç®¡ç†ç­‰æ¨¡å—
- **äº¤æ˜“æŠ¥æ–‡æ ¼å¼è¯´æ˜**ï¼šåŒ…å«å…¥å‚ã€å‡ºå‚è§„èŒƒåŠJSONæ ¼å¼æ ‡å‡†

### ç›®æ ‡äººç¾¤

ç›®æ ‡è¯»è€…ä¸ºå…·å¤‡å¼€å‘èƒ½åŠ›ã€ç†Ÿæ‚‰ç›¸å…³ç¼–ç¨‹è¯­è¨€çš„å¼€å‘ã€ç»´æŠ¤åŠç®¡ç†äººå‘˜ã€‚

### è¯·æ±‚å¤´è¯´æ˜

ğŸ’¡ **è¯·æ±‚å¤´Content-Typeä¸ºï¼šapplication/json;charset=utf-8ï¼Œæ‰€æœ‰æ¥å£ä¸€è‡´**

### ç›¸å…³æœ¯è¯­

**å¹³å°æˆ–ç³»ç»Ÿ**
æŒ‡æä¾›å°åº¦å”¤é†’æ”¯ä»˜åŠŸèƒ½çš„æˆ‘å¸ç³»ç»Ÿï¼Œç”¨äºæ”¯æŒå•†æˆ·å®Œæˆå„ç±»äº¤æ˜“ã€‚

**å•†æˆ·å· (appid)**
è¿™æ˜¯å•†æˆ·åœ¨å¹³å°ä¸Šçš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºéªŒè¯å…¶åœ¨å¹³å°çš„åˆæ³•æ€§ã€‚

**å•†æˆ·è®¢å•å· (mchOrderId)**
å•†æˆ·ç³»ç»Ÿä¸ºæ¯ç¬”è®¢å•ç”Ÿæˆçš„å”¯ä¸€ç¼–å·ï¼Œéœ€ç¡®ä¿å…¶å”¯ä¸€æ€§ï¼Œä»¥ä¾¿åœ¨å¹³å°ä¸­è¿›è¡ŒåŒºåˆ†ã€‚

**æ”¯ä»˜ç±»å‹ (payType)**
æŒ‡ç”¨æ¥åŒºåˆ†æ”¯ä»˜äº§å“ç±»åˆ«çš„å­—æ®µï¼Œå…·ä½“å†…å®¹è¯¦è§æ¥å£æè¿°ã€‚

**åŠ å¯†å¯†é’¥**
å•†æˆ·ç”¨äºäº¤æ˜“è¯·æ±‚å‰å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å’ŒéªŒç­¾çš„å…³é”®å·¥å…·ã€‚

**å¸ç§ (currency)**
ç”¨äºåŒºåˆ†è´§å¸ç±»å‹çš„å­—æ®µï¼Œè¯¦æƒ…å‚è€ƒæ¥å£æè¿°éƒ¨åˆ†ã€‚

**åå°å¼‚æ­¥å›è°ƒ (notifyUrl)**
å½“äº¤æ˜“å¤„ç†å®Œæˆåï¼Œç³»ç»Ÿä¼šä¸»åŠ¨é€šçŸ¥å•†æˆ·ç½‘ç«™å¹¶æºå¸¦ç›¸å…³ç»“æœä¿¡æ¯ã€‚

**å•†æˆ·**
æŒ‡æ¥å…¥å¹³å°å¹¶ä½¿ç”¨å…¶æ”¯ä»˜æœåŠ¡çš„å®¢æˆ·æˆ–æœºæ„ã€‚

---

## ğŸ” ç­¾åç®—æ³•

### ç­¾åè§„åˆ™

#### Step 1. æ’åºæ‹¼æ¥
å°†éç©ºå‚æ•°å€¼æŒ‰ç…§å‚æ•°åASCIIç ä»å°åˆ°å¤§æ’åºï¼ˆå­—å…¸åºï¼‰ï¼Œä½¿ç”¨URLé”®å€¼å¯¹çš„æ ¼å¼ï¼ˆå³key1=value1&key2=value2â€¦ï¼‰æ‹¼æ¥æˆå­—ç¬¦ä¸²(strStringï¼‰ã€‚
- å‚æ•°åASCIIç ä»å°åˆ°å¤§æ’åº
- å¦‚æœå‚æ•°çš„å€¼ä¸ºç©ºä¸å‚ä¸ç­¾å
- å‚æ•°ååŒºåˆ†å¤§å°å†™

#### Step 2. æ‹¼æ¥keyåŠ å¯†
å°†strStringæœ€åæ‹¼æ¥ä¸Škeyå¾—åˆ°strSignå­—ç¬¦ä¸²ï¼Œå¹¶å¯¹strSignè¿›è¡Œ`SHA-256`ï¼Œå¾—åˆ°signå€¼signValue(16è¿›åˆ¶å°å†™)

### ç¤ºä¾‹å‚è€ƒã€Javaã€‘

```java
/**
 * è®¡ç®—SHA-256æ‘˜è¦å€¼ï¼Œå¹¶è½¬ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²
 */
public static String checkSha256Hex(Map<String, Object> obj, String key, String signWebKey) {
    TreeMap<String, Object> map = mapToTreeMap(obj);
    String data = strSign(map, key, signWebKey);
    return sha256Hex(data);
}

public static String sha256Hex(String data) {
    return DigestUtil.sha256Hex(data);
}

/**
 * å­—ç¬¦æ‹¼æ¥k=1&v=2å½¢å¼
 */
public static String strSign(TreeMap<String, Object> map, String key, String signKye) {
    StringBuilder builder = new StringBuilder();
    map.forEach((k, v) -> {
        builder.append(k).append("=").append(v).append("&");
    });
    builder.append(signKye).append("=").append(key);
    return builder.toString();
}
```

---

## ğŸ” è®¤è¯å’Œç­¾åè¦æ±‚

### è®¤è¯æœºåˆ¶

æ‰€æœ‰APIæ¥å£éƒ½éœ€è¦é€šè¿‡å•†æˆ·è®¤è¯ä¸­é—´ä»¶éªŒè¯ï¼ŒåŒ…æ‹¬ï¼š

1. **å•†æˆ·èº«ä»½éªŒè¯**: éªŒè¯ `appid` å¯¹åº”çš„å•†æˆ·æ˜¯å¦å­˜åœ¨ä¸”çŠ¶æ€ä¸º `ACTIVE`
2. **ç­¾åéªŒè¯**: éªŒè¯è¯·æ±‚å‚æ•°çš„ç­¾åæ˜¯å¦æ­£ç¡®
3. **å‚æ•°å®Œæ•´æ€§**: ç¡®ä¿æ‰€æœ‰å¿…å¡«å‚æ•°éƒ½å·²æä¾›

### ç­¾åè¦æ±‚

#### ç­¾åç®—æ³•
- **ç®—æ³•**: SHA-256
- **ç¼–ç **: 16è¿›åˆ¶å°å†™
- **å¯†é’¥**: å•†æˆ·çš„ `secretKey`

#### ç­¾åæ­¥éª¤
1. **å‚æ•°è¿‡æ»¤**: ç§»é™¤ç©ºå€¼ã€nullã€undefined çš„å‚æ•°
2. **å‚æ•°æ’åº**: æŒ‰å‚æ•°åASCIIç ä»å°åˆ°å¤§æ’åº
3. **å‚æ•°æ‹¼æ¥**: ä½¿ç”¨ `key=value&key=value` æ ¼å¼æ‹¼æ¥
4. **å¯†é’¥æ‹¼æ¥**: åœ¨æœ€åæ·»åŠ  `&key=å•†æˆ·å¯†é’¥`
5. **å“ˆå¸Œè®¡ç®—**: å¯¹æ‹¼æ¥åçš„å­—ç¬¦ä¸²è¿›è¡ŒSHA-256è®¡ç®—

#### ç­¾åç¤ºä¾‹
```javascript
// åŸå§‹å‚æ•°
const params = {
  appid: 'M171925157713',
  mchOrderId: 'test_001',
  timestamp: '1726228640694',
  payType: 9111,
  amount: '100',
  currency: 'INR',
  notifyUrl: 'http://localhost:8080/notify'
};

// 1. è¿‡æ»¤ç©ºå€¼
const filteredParams = Object.keys(params)
  .filter(key => params[key] !== '' && params[key] !== null && params[key] !== undefined)
  .reduce((result, key) => {
    result[key] = params[key];
    return result;
  }, {});

// 2. æ’åºå¹¶æ‹¼æ¥
const signString = Object.keys(filteredParams)
  .sort()
  .map(key => `${key}=${filteredParams[key]}`)
  .join('&') + '&key=your_secret_key';

// 3. SHA-256è®¡ç®—
const sign = crypto.createHash('sha256').update(signString).digest('hex');
```

### è®¤è¯å¤±è´¥å“åº”

å½“è®¤è¯å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šè¿”å›ä»¥ä¸‹æ ¼å¼çš„å“åº”ï¼š

```json
{
  "code": 401,
  "message": "å•†æˆ·ä¸å­˜åœ¨æˆ–æœªæ¿€æ´»",
  "data": null
}
```

å¸¸è§è®¤è¯é”™è¯¯ï¼š

| é”™è¯¯ç  | é”™è¯¯æ¶ˆæ¯ | åŸå›  |
|--------|----------|------|
| 400 | ç¼ºå°‘å•†æˆ·ID (appid) | è¯·æ±‚ä¸­æœªæä¾›appidå‚æ•° |
| 400 | ç¼ºå°‘ç­¾åå‚æ•° (sign) | è¯·æ±‚ä¸­æœªæä¾›signå‚æ•° |
| 401 | å•†æˆ·ä¸å­˜åœ¨æˆ–æœªæ¿€æ´» | appidå¯¹åº”çš„å•†æˆ·ä¸å­˜åœ¨æˆ–çŠ¶æ€éACTIVE |
| 400 | ç­¾åéªŒè¯å¤±è´¥ | ç­¾åè®¡ç®—é”™è¯¯æˆ–å¯†é’¥ä¸æ­£ç¡® |

---

## ğŸ’³ æ”¯ä»˜ç±»å‹

### å°åº¦å”¤é†’æ”¯ä»˜ç±»å‹

| æ”¯ä»˜ç±»å‹ID | æ”¯ä»˜ç±»å‹åç§° | è¯´æ˜ | çŠ¶æ€ |
|------------|--------------|------|------|
| 9111 | å°åº¦ä¸€ç±»ï¼ˆå”¤é†’ï¼‰ | å°åº¦å”¤é†’æ”¯ä»˜æ–¹å¼ï¼Œé€šè¿‡UPIè½¬è´¦åˆ°æŒ‡å®šè´¦æˆ· | âœ… æ”¯æŒ |

**æ³¨æ„**: å½“å‰ç³»ç»Ÿä»…æ”¯æŒæ”¯ä»˜ç±»å‹ 9111ï¼Œå…¶ä»–æ”¯ä»˜ç±»å‹æš‚ä¸æ”¯æŒã€‚

---

## ğŸ’° å­˜æ¬¾è®¢å•

### ç”³è¯·å­˜æ¬¾ï¼ˆDeposité€šç”¨ï¼‰

#### æ¥å£ä¿¡æ¯

- **æ¥å£åœ°å€**: `/api/wakeup/create`
- **è¯·æ±‚æ–¹å¼**: POST
- **Content-Type**: application/json

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| appid | string | âœ… | å•†æˆ·å·ï¼ˆä¸å•†æˆ·IDä¸€è‡´ï¼‰ |
| orderid | string | âœ… | å•†æˆ·è®¢å•å·(å”¯ä¸€ä¸é‡å¤ï¼Œé•¿åº¦è‡³å°‘6ä½) |
| timestamp | string | âœ… | è¯·æ±‚æ—¶é—´æˆ³(unixæ—¶é—´æˆ³æ¯«ç§’) |
| payType | integer | âœ… | æ”¯ä»˜ç±»å‹ï¼ˆå›ºå®šä¸º9111ï¼‰ |
| amount | string | âœ… | æ”¯ä»˜é‡‘é¢å…ƒ(å¯æ¥æ”¶å°æ•°ç‚¹å2ä½) |
| currency | string | âœ… | å¸ç§ï¼ˆå›ºå®šä¸ºINRï¼‰ |
| notify_url | string | âœ… | æ”¯ä»˜ç»“æœé€šçŸ¥åœ°å€ |
| return_url | string | âœ… | æ”¯ä»˜å®Œæˆè¿”å›åœ°å€ |
| customer_phone | string | âœ… | å®¢æˆ·æ‰‹æœºå· |
| desc | string | âŒ | è®¢å•æè¿° |
| useDhPay | boolean | âŒ | æ˜¯å¦ä½¿ç”¨DhPayä½œä¸ºä¸Šæ¸¸æ”¯ä»˜é€šé“ |
| sign | string | âœ… | ç­¾åï¼ˆæ­¤å­—æ®µä¸å‚ä¸ç­¾åï¼‰ |

#### è¯·æ±‚ç¤ºä¾‹

```json
{
  "appid": "M171925157713",
  "orderid": "test001",
  "timestamp": "1726228640694",
  "payType": 9111,
  "amount": "105",
  "currency": "INR",
  "notify_url": "http://localhost:8080/notify",
  "return_url": "http://localhost:8080/return",
  "customer_phone": "919876543210",
  "desc": "Game deposit",
  "useDhPay": false,
  "sign": "7c5642e9ec5455b5a09af5abc6543da10b4fbc835b16432802af96327ea0b880"
}
```

#### å“åº”å‚æ•°

| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | å“åº”çŠ¶æ€ç ï¼Œ200è¡¨ç¤ºæˆåŠŸ |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | å“åº”æ•°æ®ï¼ˆæˆåŠŸæ—¶ï¼‰ |
| data.orderid | string | å•†æˆ·è®¢å•å· |
| data.status | string | è®¢å•çŠ¶æ€ |
| data.message | string | å“åº”æ¶ˆæ¯ |
| data.upi_transfer_info | object | UPIè½¬è´¦ä¿¡æ¯ï¼ˆä¼ ç»Ÿå”¤é†’æ¨¡å¼ï¼‰ |
| data.payment_url | string | æ”¯ä»˜é“¾æ¥ï¼ˆDhPayæ¨¡å¼ï¼‰ |
| data.dhpay_order_id | string | DhPayè®¢å•IDï¼ˆDhPayæ¨¡å¼ï¼‰ |
| data.verification_required | boolean | æ˜¯å¦éœ€è¦éªŒè¯ |

#### å“åº”ç¤ºä¾‹ï¼ˆä¼ ç»Ÿå”¤é†’æ¨¡å¼ï¼‰

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "orderid": "test001",
    "status": "PENDING",
    "message": "è¯·é€šè¿‡UPIè½¬è´¦åˆ°æŒ‡å®šè´¦æˆ·ï¼Œè½¬è´¦å®Œæˆåç³»ç»Ÿå°†è‡ªåŠ¨éªŒè¯",
    "upi_transfer_info": {
      "beneficiaryName": "RAHUL KUMAR",
      "beneficiaryUPI": "rahul.kumar@hdfc",
      "beneficiaryAccount": "1234567890",
      "ifscCode": "HDFC0001234",
      "bankName": "HDFC Bank",
      "amount": 105,
      "currency": "INR",
      "transferNote": "Order: test001 - Game deposit",
      "expectedCompletionTime": "5-10 minutes"
    },
    "verification_required": true
  }
}
```

#### å“åº”ç¤ºä¾‹ï¼ˆDhPayæ¨¡å¼ï¼‰

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "orderid": "test001",
    "status": "PENDING",
    "message": "DhPayè®¢å•åˆ›å»ºæˆåŠŸ",
    "payment_url": "https://test-api.dhpay.com/payment/12345",
    "dhpay_order_id": "DH20240101123456",
    "verification_required": false
  }
}
```

---

## ğŸ’¸ å‡ºæ¬¾è®¢å•

### ç”³è¯·å‡ºæ¬¾ï¼ˆWithdrawé€šç”¨ï¼‰

#### æ¥å£ä¿¡æ¯

- **æ¥å£åœ°å€**: `/api/payout/create`
- **è¯·æ±‚æ–¹å¼**: POST
- **Content-Type**: application/json

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| appid | string | âœ… | å•†æˆ·å·ï¼ˆä¸å•†æˆ·IDä¸€è‡´ï¼‰ |
| mchOrderId | string | âœ… | å•†æˆ·è®¢å•å·(å”¯ä¸€ä¸é‡å¤) |
| timestamp | string | âœ… | è¯·æ±‚æ—¶é—´æˆ³(unixæ—¶é—´æˆ³æ¯«ç§’) |
| payType | integer | âœ… | æ”¯ä»˜ç±»å‹ï¼ˆå›ºå®šä¸º9111ï¼‰ |
| amount | string | âœ… | å‡ºæ¬¾é‡‘é¢å…ƒ(å¯æ¥æ”¶å°æ•°ç‚¹å2ä½) |
| currency | string | âœ… | å¸ç§ï¼ˆå›ºå®šä¸ºINRï¼‰ |
| notifyUrl | string | âœ… | å‡ºæ¬¾ç»“æœé€šçŸ¥åœ°å€ |
| customerPhone | string | âœ… | å®¢æˆ·æ‰‹æœºå· |
| sign | string | âœ… | ç­¾åï¼ˆæ­¤å­—æ®µä¸å‚ä¸ç­¾åï¼‰ |

#### è¯·æ±‚ç¤ºä¾‹

```json
{
  "appid": "M171925157713",
  "mchOrderId": "withdraw_test",
  "timestamp": "1726228640694",
  "payType": 9111,
  "amount": "100",
  "currency": "INR",
  "notifyUrl": "http://localhost:8080/withdraw_notify",
  "customerPhone": "919876543210",
  "sign": "7c5642e9ec5455b5a09af5abc6543da10b4fbc835b16432802af96327ea0b880"
}
```

#### å“åº”å‚æ•°

| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | å“åº”çŠ¶æ€ç ï¼Œ200è¡¨ç¤ºæˆåŠŸ |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | å“åº”æ•°æ®ï¼ˆæˆåŠŸæ—¶ï¼‰ |
| data.orderid | string | å•†æˆ·è®¢å•å· |
| data.status | string | è®¢å•çŠ¶æ€ |
| data.message | string | å“åº”æ¶ˆæ¯ |

---

## ğŸ“¡ å¼‚æ­¥é€šçŸ¥

### æ”¯ä»˜ç»“æœé€šçŸ¥

#### é€šçŸ¥åœ°å€
å•†æˆ·åœ¨åˆ›å»ºè®¢å•æ—¶æä¾›çš„ `notifyUrl`

#### é€šçŸ¥å‚æ•°

| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| orderId | string | å•†æˆ·è®¢å•å· |
| status | string | è®¢å•çŠ¶æ€ |
| amount | number | æ”¯ä»˜é‡‘é¢ |
| currency | string | å¸ç§ |
| timestamp | string | é€šçŸ¥æ—¶é—´æˆ³ |
| sign | string | ç­¾å |

#### è®¢å•çŠ¶æ€è¯´æ˜

| çŠ¶æ€å€¼ | è¯´æ˜ |
|--------|------|
| PENDING_VERIFICATION | å¾…éªŒè¯ï¼ˆç­‰å¾…UPIè½¬è´¦å®Œæˆï¼‰ |
| SUCCESS | æ”¯ä»˜æˆåŠŸ |
| FAILED | æ”¯ä»˜å¤±è´¥ |
| CANCELLED | è®¢å•å–æ¶ˆ |

---

## ğŸ” æŸ¥è¯¢æ¥å£

### è®¢å•æŸ¥è¯¢

#### æ¥å£ä¿¡æ¯

- **æ¥å£åœ°å€**: `/api/wakeup/query`
- **è¯·æ±‚æ–¹å¼**: POST
- **Content-Type**: application/json

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| appid | string | âœ… | å•†æˆ·å· |
| orderid | string | âœ… | å•†æˆ·è®¢å•å· |
| timestamp | string | âœ… | è¯·æ±‚æ—¶é—´æˆ³ |
| sign | string | âœ… | ç­¾å |

#### è¯·æ±‚ç¤ºä¾‹

```json
{
  "appid": "M171925157713",
  "orderid": "test001",
  "timestamp": "1726228640694",
  "sign": "calculated_signature_here"
}
```

#### å“åº”å‚æ•°

| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | integer | å“åº”çŠ¶æ€ç ï¼Œ200è¡¨ç¤ºæˆåŠŸ |
| message | string | å“åº”æ¶ˆæ¯ |
| data | object | è®¢å•æ•°æ® |
| data.orderid | string | å•†æˆ·è®¢å•å· |
| data.status | string | è®¢å•çŠ¶æ€ |
| data.message | string | çŠ¶æ€æè¿° |
| data.transfer_info | object | è½¬è´¦ä¿¡æ¯ |

#### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "orderid": "test001",
    "status": "PENDING_VERIFICATION",
    "message": "ç­‰å¾…UPIè½¬è´¦å®Œæˆ",
    "transfer_info": {
      "beneficiaryName": "RAHUL KUMAR",
      "beneficiaryUPI": "rahul.kumar@hdfc",
      "amount": 105
    }
  }
}
```

---

## âŒ é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| 400 | å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•°æ ¼å¼å’Œå¿…å¡«é¡¹ |
| 401 | è®¤è¯å¤±è´¥ | æ£€æŸ¥å•†æˆ·å·å’Œç­¾å |
| 500 | ç³»ç»Ÿé”™è¯¯ | è”ç³»æŠ€æœ¯æ”¯æŒ |

---

## ğŸ’» ç¤ºä¾‹ä»£ç 

### Node.js ç¤ºä¾‹

```javascript
const crypto = require('crypto');

// ç”Ÿæˆç­¾å
function generateSign(params, secretKey) {
  // è¿‡æ»¤ç©ºå€¼å¹¶æ’åº
  const sortedParams = Object.keys(params)
    .filter(key => params[key] !== '' && params[key] !== null && params[key] !== undefined)
    .sort()
    .reduce((result, key) => {
      result[key] = params[key];
      return result;
    }, {});
  
  // æ‹¼æ¥å‚æ•°
  const signString = Object.keys(sortedParams)
    .map(key => `${key}=${sortedParams[key]}`)
    .join('&') + `&key=${secretKey}`;
  
  // SHA-256åŠ å¯†
  return crypto.createHash('sha256').update(signString).digest('hex');
}

// åˆ›å»ºå­˜æ¬¾è®¢å•
async function createDepositOrder() {
  const params = {
    appid: 'M171925157713',
    orderid: 'test_' + Date.now(),
    timestamp: Date.now().toString(),
    payType: 9111,
    amount: '100',
    currency: 'INR',
    notify_url: 'http://localhost:8080/notify',
    return_url: 'http://localhost:8080/return',
    customer_phone: '919876543210',
    desc: 'Game deposit',
    useDhPay: false
  };
  
  // ç”Ÿæˆç­¾å
  params.sign = generateSign(params, 'your_secret_key');
  
  try {
    const response = await fetch('https://cashgit.com/api/wakeup/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(params)
    });
    
    const result = await response.json();
    
    // æ£€æŸ¥å“åº”æ ¼å¼
    if (result.code === 200) {
      console.log('âœ… è®¢å•åˆ›å»ºæˆåŠŸ:', result.data);
      if (result.data.upi_transfer_info) {
        console.log('ğŸ’³ UPIè½¬è´¦ä¿¡æ¯:', result.data.upi_transfer_info);
      }
      if (result.data.payment_url) {
        console.log('ğŸ”— æ”¯ä»˜é“¾æ¥:', result.data.payment_url);
      }
    } else {
      console.error('âŒ è®¢å•åˆ›å»ºå¤±è´¥:', result.message);
    }
  } catch (error) {
    console.error('åˆ›å»ºè®¢å•å¤±è´¥:', error);
  }
}

// æŸ¥è¯¢è®¢å•çŠ¶æ€
async function queryOrderStatus(orderid) {
  const params = {
    appid: 'M171925157713',
    orderid: orderid,
    timestamp: Date.now().toString()
  };
  
  params.sign = generateSign(params, 'your_secret_key');
  
  try {
    const response = await fetch('https://cashgit.com/api/wakeup/query', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(params)
    });
    
    const result = await response.json();
    
    if (result.code === 200) {
      console.log('âœ… æŸ¥è¯¢æˆåŠŸ:', result.data);
      return result.data;
    } else {
      console.error('âŒ æŸ¥è¯¢å¤±è´¥:', result.message);
      return null;
    }
  } catch (error) {
    console.error('æŸ¥è¯¢è®¢å•å¤±è´¥:', error);
    return null;
  }
}

// æ‰‹åŠ¨éªŒè¯è½¬è´¦
async function verifyTransfer(orderid, utrNumber, transferAmount) {
  const params = {
    appid: 'M171925157713',
    orderid: orderid,
    utr_number: utrNumber,
    transfer_amount: transferAmount.toString(),
    transfer_date: new Date().toISOString(),
    timestamp: Date.now().toString()
  };
  
  params.sign = generateSign(params, 'your_secret_key');
  
  try {
    const response = await fetch('https://cashgit.com/api/wakeup/verify', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(params)
    });
    
    const result = await response.json();
    
    if (result.code === 200) {
      console.log('âœ… éªŒè¯æˆåŠŸ:', result.data);
      return result.data;
    } else {
      console.error('âŒ éªŒè¯å¤±è´¥:', result.message);
      return null;
    }
  } catch (error) {
    console.error('éªŒè¯è½¬è´¦å¤±è´¥:', error);
    return null;
  }
}

// å®Œæ•´çš„é”™è¯¯å¤„ç†ç¤ºä¾‹
async function createOrderWithErrorHandling() {
  try {
    const params = {
      appid: 'M171925157713',
      orderid: 'test_' + Date.now(),
      timestamp: Date.now().toString(),
      payType: 9111,
      amount: '100',
      currency: 'INR',
      notify_url: 'http://localhost:8080/notify',
      return_url: 'http://localhost:8080/return',
      customer_phone: '919876543210',
      desc: 'Game deposit',
      useDhPay: false
    };
    
    params.sign = generateSign(params, 'your_secret_key');
    
    const response = await fetch('https://cashgit.com/api/wakeup/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(params)
    });
    
    const result = await response.json();
    
    switch (result.code) {
      case 200:
        console.log('âœ… è®¢å•åˆ›å»ºæˆåŠŸ');
        console.log('è®¢å•ID:', result.data.orderid);
        console.log('çŠ¶æ€:', result.data.status);
        if (result.data.upi_transfer_info) {
          console.log('ğŸ’³ UPIè½¬è´¦ä¿¡æ¯:', result.data.upi_transfer_info);
        }
        if (result.data.payment_url) {
          console.log('ğŸ”— æ”¯ä»˜é“¾æ¥:', result.data.payment_url);
        }
        break;
      case 400:
        console.error('âŒ å‚æ•°é”™è¯¯:', result.message);
        break;
      case 401:
        console.error('âŒ è®¤è¯å¤±è´¥:', result.message);
        break;
      case 500:
        console.error('âŒ ç³»ç»Ÿé”™è¯¯:', result.message);
        break;
      default:
        console.error('âŒ æœªçŸ¥é”™è¯¯:', result.message);
    }
  } catch (error) {
    console.error('ç½‘ç»œé”™è¯¯:', error.message);
  }
}
```

---

## ğŸ§ª æµ‹è¯•ç¯å¢ƒè¦æ±‚

### æµ‹è¯•å•†æˆ·è®¾ç½®

åœ¨æµ‹è¯•APIæ¥å£ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿ï¼š

1. **å•†æˆ·å·²åˆ›å»º**: åœ¨ç³»ç»Ÿä¸­åˆ›å»ºæµ‹è¯•å•†æˆ·è´¦æˆ·
2. **å•†æˆ·çŠ¶æ€**: å•†æˆ·çŠ¶æ€å¿…é¡»ä¸º `ACTIVE`
3. **æ”¯ä»˜é…ç½®**: é…ç½®å¯¹åº”çš„æ”¯ä»˜æä¾›å•†ï¼ˆå¦‚wakeupï¼‰
4. **å¯†é’¥é…ç½®**: ç¡®ä¿å•†æˆ·çš„ `secretKey` æ­£ç¡®é…ç½®

### åˆ›å»ºæµ‹è¯•å•†æˆ·

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬åˆ›å»ºæµ‹è¯•å•†æˆ·ï¼š

```javascript
// åˆ›å»ºæµ‹è¯•å•†æˆ·è„šæœ¬
const mongoose = require('mongoose');
const Merchant = require('./models/merchant');

async function createTestMerchant() {
  try {
    await mongoose.connect('mongodb://localhost:27017/payment-platform');
    
    const testMerchant = new Merchant({
      merchantId: 'TEST_MERCHANT_001',
      name: 'æµ‹è¯•å•†æˆ·',
      email: 'test@example.com',
      status: 'ACTIVE',
      apiKey: 'test_api_key_123',
      secretKey: 'test_secret_key_123'
    });
    
    await testMerchant.save();
    console.log('âœ… æµ‹è¯•å•†æˆ·åˆ›å»ºæˆåŠŸ:', testMerchant.merchantId);
  } catch (error) {
    console.error('âŒ åˆ›å»ºæµ‹è¯•å•†æˆ·å¤±è´¥:', error);
  }
}
```

### æµ‹è¯•æ•°æ®å‡†å¤‡

1. **è®¢å•ID**: ç¡®ä¿æ¯æ¬¡æµ‹è¯•ä½¿ç”¨å”¯ä¸€çš„è®¢å•ID
2. **é‡‘é¢**: ä½¿ç”¨åˆç†çš„æµ‹è¯•é‡‘é¢ï¼ˆå¦‚100 INRï¼‰
3. **å›è°ƒURL**: ä½¿ç”¨å¯è®¿é—®çš„æµ‹è¯•å›è°ƒåœ°å€
4. **æ—¶é—´æˆ³**: ä½¿ç”¨å½“å‰æ—¶é—´æˆ³ï¼Œç¡®ä¿ä¸é‡å¤

### æµ‹è¯•æµç¨‹å»ºè®®

1. **åŸºç¡€è®¤è¯æµ‹è¯•**: å…ˆæµ‹è¯•å•†æˆ·è®¤è¯å’Œç­¾åéªŒè¯
2. **å‚æ•°éªŒè¯æµ‹è¯•**: æµ‹è¯•å„ç§å‚æ•°ç»„åˆå’Œè¾¹ç•Œå€¼
3. **ä¸šåŠ¡æµç¨‹æµ‹è¯•**: æµ‹è¯•å®Œæ•´çš„è®¢å•åˆ›å»ºå’ŒæŸ¥è¯¢æµç¨‹
4. **é”™è¯¯å¤„ç†æµ‹è¯•**: æµ‹è¯•å„ç§é”™è¯¯æƒ…å†µçš„å¤„ç†

### å¸¸è§æµ‹è¯•é—®é¢˜

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| å•†æˆ·ä¸å­˜åœ¨ | å•†æˆ·æœªåˆ›å»ºæˆ–çŠ¶æ€éACTIVE | æ£€æŸ¥å•†æˆ·é…ç½®å’ŒçŠ¶æ€ |
| ç­¾åéªŒè¯å¤±è´¥ | å¯†é’¥é”™è¯¯æˆ–ç­¾åç®—æ³•é”™è¯¯ | æ£€æŸ¥secretKeyå’Œç­¾åè®¡ç®— |
| æ”¯ä»˜é…ç½®ç¼ºå¤± | æœªé…ç½®å¯¹åº”çš„æ”¯ä»˜æä¾›å•† | åœ¨åå°é…ç½®æ”¯ä»˜æä¾›å•† |
| è®¢å•IDé‡å¤ | ä½¿ç”¨äº†å·²å­˜åœ¨çš„è®¢å•ID | ä½¿ç”¨æ–°çš„å”¯ä¸€è®¢å•ID |

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ”¯ä»˜ç±»å‹**: å½“å‰ç³»ç»Ÿä»…æ”¯æŒæ”¯ä»˜ç±»å‹ 9111ï¼ˆå°åº¦ä¸€ç±»å”¤é†’ï¼‰
2. **å¸ç§**: ä»…æ”¯æŒ INR å¸ç§
3. **è®¢å•ID**: å¿…é¡»å”¯ä¸€ï¼Œé•¿åº¦è‡³å°‘6ä½
4. **é‡‘é¢**: æ”¯æŒå°æ•°ç‚¹å2ä½ï¼Œæœ€å°é‡‘é¢1 INR
5. **éªŒè¯æµç¨‹**: 
   - **ä¼ ç»Ÿå”¤é†’æ¨¡å¼**: ç”¨æˆ·é€šè¿‡UPIè½¬è´¦åˆ°æŒ‡å®šè´¦æˆ·ï¼Œç³»ç»Ÿè‡ªåŠ¨æˆ–æ‰‹åŠ¨éªŒè¯
   - **DhPayæ¨¡å¼**: é€šè¿‡DhPayæä¾›çš„æ”¯ä»˜é“¾æ¥å®Œæˆæ”¯ä»˜
6. **å“åº”æ ¼å¼**: ç³»ç»Ÿä½¿ç”¨ `code` å­—æ®µè¡¨ç¤ºçŠ¶æ€ç ï¼Œ200è¡¨ç¤ºæˆåŠŸ
7. **è®¤è¯è¦æ±‚**: æ‰€æœ‰æ¥å£éƒ½éœ€è¦å•†æˆ·è®¤è¯å’Œç­¾åéªŒè¯
8. **ç­¾åç®—æ³•**: ä½¿ç”¨SHA-256ç®—æ³•ï¼Œå¯†é’¥ä¸ºå•†æˆ·çš„secretKey
9. **é”™è¯¯å¤„ç†**: ç³»ç»Ÿè¿”å›ç»Ÿä¸€çš„é”™è¯¯æ ¼å¼ï¼ŒåŒ…å«codeã€messageå’Œdataå­—æ®µ
10. **ä¸¤ç§æ¨¡å¼**:
    - **ä¼ ç»Ÿå”¤é†’**: è¿”å›UPIè½¬è´¦ä¿¡æ¯ï¼Œéœ€è¦æ‰‹åŠ¨éªŒè¯
    - **DhPayé›†æˆ**: è¿”å›æ”¯ä»˜é“¾æ¥ï¼Œè‡ªåŠ¨å¤„ç†æ”¯ä»˜æµç¨‹
11. **æ‰‹åŠ¨éªŒè¯**: æ”¯æŒé€šè¿‡UTRå·ç æ‰‹åŠ¨éªŒè¯è½¬è´¦å®Œæˆ
12. **è´¦æˆ·ç®¡ç†**: ç³»ç»Ÿç»´æŠ¤å¤šä¸ªæ”¶æ¬¾è´¦æˆ·ï¼Œè‡ªåŠ¨é€‰æ‹©å¯ç”¨è´¦æˆ·
13. **å›è°ƒé€šçŸ¥**: æ”¯ä»˜å®Œæˆåä¼šå‘å•†æˆ·çš„notify_urlå‘é€å¼‚æ­¥é€šçŸ¥
14. **æµ‹è¯•ç¯å¢ƒ**: éœ€è¦å…ˆåˆ›å»ºæµ‹è¯•å•†æˆ·å¹¶é…ç½®wakeupæ”¯ä»˜æä¾›å•†

## ğŸ”„ æ”¯ä»˜æµç¨‹è¯´æ˜

### ä¼ ç»Ÿå”¤é†’æ¨¡å¼æµç¨‹
1. å•†æˆ·è°ƒç”¨åˆ›å»ºè®¢å•æ¥å£
2. ç³»ç»Ÿè¿”å›UPIè½¬è´¦ä¿¡æ¯
3. ç”¨æˆ·æ‰‹åŠ¨é€šè¿‡UPIåº”ç”¨è½¬è´¦
4. ç³»ç»Ÿæ£€æµ‹åˆ°è½¬è´¦æˆ–å•†æˆ·æ‰‹åŠ¨éªŒè¯
5. ç³»ç»Ÿå‘é€å›è°ƒé€šçŸ¥ç»™å•†æˆ·

### DhPayæ¨¡å¼æµç¨‹  
1. å•†æˆ·è°ƒç”¨åˆ›å»ºè®¢å•æ¥å£ï¼ˆè®¾ç½®useDhPay=trueï¼‰
2. ç³»ç»Ÿè¿”å›DhPayæ”¯ä»˜é“¾æ¥
3. ç”¨æˆ·é€šè¿‡æ”¯ä»˜é“¾æ¥å®Œæˆæ”¯ä»˜
4. DhPayå‘é€å›è°ƒç»™ç³»ç»Ÿ
5. ç³»ç»Ÿå‘é€å›è°ƒé€šçŸ¥ç»™å•†æˆ·

## ğŸ”§ é¢å¤–æ¥å£

### æ‰‹åŠ¨éªŒè¯è½¬è´¦
- **æ¥å£åœ°å€**: `/api/wakeup/verify`
- **ç”¨é€”**: å½“è‡ªåŠ¨éªŒè¯å¤±è´¥æ—¶ï¼Œå¯é€šè¿‡UTRå·ç æ‰‹åŠ¨éªŒè¯è½¬è´¦

### è·å–æ”¶æ¬¾è´¦æˆ·
- **æ¥å£åœ°å€**: `/api/wakeup/accounts`  
- **ç”¨é€”**: è·å–å½“å‰å¯ç”¨çš„æ”¶æ¬¾è´¦æˆ·ä¿¡æ¯

### çŠ¶æ€æ£€æŸ¥
- **æ¥å£åœ°å€**: `/api/wakeup/check-status`
- **ç”¨é€”**: å®šæ—¶ä»»åŠ¡è°ƒç”¨ï¼Œæ£€æŸ¥å¾…éªŒè¯è®¢å•çš„è½¬è´¦çŠ¶æ€

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [ç³»ç»ŸçŠ¶æ€ç›‘æ§](/api/health)
- [æ”¯ä»˜é…ç½®ç®¡ç†](/api/payment-config)
- [å•†æˆ·ç®¡ç†](/api/merchant)
