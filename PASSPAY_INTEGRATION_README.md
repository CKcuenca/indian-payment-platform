# ğŸš€ PassPayé›†æˆæ¶æ„è¯´æ˜

## ğŸ“‹ ç³»ç»Ÿæ¶æ„æ¦‚è¿°

æ‚¨çš„ç³»ç»Ÿç°åœ¨ä½œä¸º**PassPayçš„ä¸‹æ¸¸èšåˆæ”¯ä»˜å¹³å°**ï¼Œå®Œæ•´çš„æ”¯ä»˜æµç¨‹å¦‚ä¸‹ï¼š

```
å•†æˆ· â†’ æ‚¨çš„ç³»ç»Ÿ(CashGit) â†’ PassPay â†’ é“¶è¡Œ/UPI
```

### ğŸ”„ æ•°æ®æµå‘

1. **ä¸‹æ¸¸å•†æˆ·** å‘æ‚¨çš„ç³»ç»Ÿå‘èµ·æ”¯ä»˜è¯·æ±‚
2. **æ‚¨çš„ç³»ç»Ÿ** æ¥æ”¶è¯·æ±‚ï¼ŒéªŒè¯ç­¾åï¼Œåˆ›å»ºæœ¬åœ°è®¢å•
3. **æ‚¨çš„ç³»ç»Ÿ** è°ƒç”¨ **PassPayçš„API** æ¥å®Œæˆå®é™…çš„æ”¯ä»˜å¤„ç†
4. **PassPay** å¤„ç†æ”¯ä»˜å¹¶ä¸é“¶è¡Œ/UPIäº¤äº’
5. **PassPay** å°†ç»“æœå›è°ƒç»™æ‚¨çš„ç³»ç»Ÿ
6. **æ‚¨çš„ç³»ç»Ÿ** å°†ç»“æœé€šçŸ¥ç»™ä¸‹æ¸¸å•†æˆ·

## ğŸ› ï¸ å·²å®ç°çš„åŠŸèƒ½

### 1. **ä»£æ”¶åŠŸèƒ½**
- âœ… **åˆ›å»ºä»£æ”¶è®¢å•** (`POST /api/pay`)
  - æ¥æ”¶å•†æˆ·è¯·æ±‚
  - è°ƒç”¨PassPayåˆ›å»ºè®¢å•
  - è¿”å›PassPayçš„äº¤æ˜“å·

- âœ… **æŸ¥è¯¢ä»£æ”¶è®¢å•çŠ¶æ€** (`POST /api/query`)
  - è°ƒç”¨PassPayæŸ¥è¯¢æœ€æ–°çŠ¶æ€
  - è‡ªåŠ¨åŒæ­¥æœ¬åœ°è®¢å•çŠ¶æ€
  - è¿”å›å®æ—¶çŠ¶æ€ä¿¡æ¯

### 2. **UTRç®¡ç†**
- âœ… **UTRè¡¥å•** (`POST /api/utr/submit`)
  - æ¥æ”¶å•†æˆ·UTRä¿¡æ¯
  - è°ƒç”¨PassPayæäº¤UTR
  - æ›´æ–°æœ¬åœ°è®¢å•çŠ¶æ€

- âœ… **UTRçŠ¶æ€æŸ¥è¯¢** (`POST /api/utr/query`)
  - è°ƒç”¨PassPayæŸ¥è¯¢UTRçŠ¶æ€
  - è¿”å›éªŒè¯ç»“æœ

### 3. **UPIæŸ¥è¯¢**
- âœ… **UPIçŠ¶æ€æŸ¥è¯¢** (`POST /api/upi/query`)
  - è°ƒç”¨PassPayæŸ¥è¯¢UPIçŠ¶æ€
  - è¿”å›UPIæ´»è·ƒçŠ¶æ€

### 4. **ä»£ä»˜åŠŸèƒ½**
- âœ… **åˆ›å»ºä»£ä»˜è®¢å•** (`POST /api/payout/create`)
  - æ¥æ”¶å•†æˆ·ä»£ä»˜è¯·æ±‚
  - è°ƒç”¨PassPayåˆ›å»ºä»£ä»˜è®¢å•
  - è¿”å›PassPayäº¤æ˜“å·

- âœ… **æŸ¥è¯¢ä»£ä»˜è®¢å•çŠ¶æ€** (`POST /api/payout/query`)
  - è°ƒç”¨PassPayæŸ¥è¯¢ä»£ä»˜çŠ¶æ€
  - è‡ªåŠ¨åŒæ­¥æœ¬åœ°çŠ¶æ€

### 5. **ä½™é¢æŸ¥è¯¢**
- âœ… **ä½™é¢æŸ¥è¯¢** (`POST /api/balance/query`)
  - è°ƒç”¨PassPayæŸ¥è¯¢å®æ—¶ä½™é¢
  - å¤±è´¥æ—¶å›é€€åˆ°æœ¬åœ°è®¡ç®—

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

1. **PassPayClient** (`server/services/passpay-client.js`)
   - PassPay APIå®¢æˆ·ç«¯
   - å¤„ç†æ‰€æœ‰ä¸PassPayçš„é€šä¿¡
   - ç­¾åç”Ÿæˆå’ŒéªŒè¯
   - çŠ¶æ€æ˜ å°„å’Œé”™è¯¯å¤„ç†

2. **è·¯ç”±å±‚** (`server/routes/cashgitPayment.js`)
   - æ¥æ”¶å•†æˆ·è¯·æ±‚
   - è°ƒç”¨PassPayClient
   - å¤„ç†å“åº”å’Œé”™è¯¯
   - ç»´æŠ¤æœ¬åœ°æ•°æ®ä¸€è‡´æ€§

3. **æ•°æ®æ¨¡å‹**
   - **Order**: æ”¯æŒUTRå­—æ®µ (`utrNumber`, `utrAmount`)
   - **Transaction**: æ”¯æŒUTRè®°å½•
   - **PaymentConfig**: å­˜å‚¨PassPayé…ç½®

### é”™è¯¯å¤„ç†ç­–ç•¥

- **PassPayè°ƒç”¨å¤±è´¥æ—¶**ï¼šè¿”å›æœ¬åœ°çŠ¶æ€ï¼Œç¡®ä¿ç³»ç»Ÿå¯ç”¨æ€§
- **ç½‘ç»œè¶…æ—¶**ï¼šè®¾ç½®10ç§’è¶…æ—¶ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
- **çŠ¶æ€åŒæ­¥**ï¼šè‡ªåŠ¨æ›´æ–°æœ¬åœ°è®¢å•çŠ¶æ€ï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§

## ğŸ“ æ–‡ä»¶ç»“æ„

```
server/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ passpay-client.js          # PassPay APIå®¢æˆ·ç«¯
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ cashgitPayment.js          # æ”¯ä»˜è·¯ç”±ï¼ˆå·²æ›´æ–°ï¼‰
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ order.js                   # è®¢å•æ¨¡å‹ï¼ˆå·²æ›´æ–°ï¼‰
â”‚   â””â”€â”€ transaction.js             # äº¤æ˜“æ¨¡å‹ï¼ˆå·²æ›´æ–°ï¼‰
â””â”€â”€ config/
    â””â”€â”€ passpay-config-example.js  # é…ç½®ç¤ºä¾‹

test-passpay-integration.js        # é›†æˆæµ‹è¯•æ–‡ä»¶
PASSPAY_INTEGRATION_README.md      # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®PassPay

```bash
# å¤åˆ¶é…ç½®ç¤ºä¾‹
cp server/config/passpay-config-example.js server/config/passpay-config.js

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„PassPayä¿¡æ¯
vim server/config/passpay-config.js
```

### 2. æ•°æ®åº“é…ç½®

```javascript
// åœ¨MongoDBä¸­æ·»åŠ PassPayé…ç½®
db.paymentconfigs.insertOne({
  "provider": {
    "name": "passpay",
    "accountId": "your_mchid_here",
    "payId": "your_pay_id_here", 
    "secretKey": "your_secret_key_here"
  },
  "enabled": true,
  "createdAt": new Date(),
  "updatedAt": new Date()
})
```

### 3. æµ‹è¯•é›†æˆ

```bash
# è¿è¡Œé›†æˆæµ‹è¯•
node test-passpay-integration.js
```

## ğŸ” APIæ¥å£è¯¦æƒ…

### ä»£æ”¶è®¢å•åˆ›å»º
```http
POST /api/pay
Content-Type: application/json

{
  "appid": "merchant_appid",
  "orderid": "unique_order_id",
  "amount": "100.00",
  "desc": "è®¢å•æè¿°",
  "notify_url": "https://merchant.com/notify",
  "sign": "md5_signature"
}
```

### UTRè¡¥å•
```http
POST /api/utr/submit
Content-Type: application/json

{
  "appid": "merchant_appid",
  "orderid": "order_id",
  "utr_number": "UTR123456789",
  "amount": "100.00",
  "sign": "md5_signature"
}
```

### ä»£ä»˜è®¢å•åˆ›å»º
```http
POST /api/payout/create
Content-Type: application/json

{
  "appid": "merchant_appid",
  "orderid": "unique_payout_id",
  "amount": "500.00",
  "account_number": "1234567890",
  "ifsc_code": "SBIN0001234",
  "account_holder": "Account Holder Name",
  "notify_url": "https://merchant.com/payout_notify",
  "sign": "md5_signature"
}
```

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### 1. **å›è°ƒå¤„ç†**
- å®ç°PassPayå›è°ƒæ¥æ”¶æ¥å£
- éªŒè¯å›è°ƒç­¾å
- è‡ªåŠ¨æ›´æ–°è®¢å•çŠ¶æ€
- è½¬å‘é€šçŸ¥ç»™å•†æˆ·

### 2. **çŠ¶æ€ç®¡ç†**
- å¢å¼ºè®¢å•çŠ¶æ€æµè½¬ç®¡ç†
- æ·»åŠ çŠ¶æ€å˜æ›´æ—¥å¿—
- å®ç°çŠ¶æ€åŒæ­¥å®šæ—¶ä»»åŠ¡

### 3. **é£æ§è§„åˆ™**
- æ·»åŠ ä¸šåŠ¡é£æ§é€»è¾‘
- å®ç°é™é¢æ§åˆ¶
- æ·»åŠ å¼‚å¸¸äº¤æ˜“æ£€æµ‹

### 4. **ç›‘æ§å‘Šè­¦**
- é›†æˆç³»ç»Ÿç›‘æ§
- æ·»åŠ å¼‚å¸¸å‘Šè­¦æœºåˆ¶
- å®ç°æ€§èƒ½æŒ‡æ ‡æ”¶é›†

## ğŸ”’ å®‰å…¨è€ƒè™‘

- **ç­¾åéªŒè¯**ï¼šæ‰€æœ‰APIè¯·æ±‚éƒ½ç»è¿‡MD5ç­¾åéªŒè¯
- **å‚æ•°è¿‡æ»¤**ï¼šè‡ªåŠ¨è¿‡æ»¤ç©ºå€¼å’Œæ¶æ„å‚æ•°
- **è¶…æ—¶æ§åˆ¶**ï¼šè®¾ç½®åˆç†çš„APIè°ƒç”¨è¶…æ—¶æ—¶é—´
- **é”™è¯¯å¤„ç†**ï¼šä¸æš´éœ²å†…éƒ¨é”™è¯¯ä¿¡æ¯ç»™å•†æˆ·

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **PassPayé…ç½®**ï¼šç¡®è®¤accountIdã€payIdã€secretKeyæ­£ç¡®
2. **ç½‘ç»œè¿æ¥**ï¼šç¡®ä¿èƒ½è®¿é—®PassPay API
3. **æ•°æ®åº“é…ç½®**ï¼šç¡®è®¤PaymentConfigè®°å½•å­˜åœ¨
4. **æ—¥å¿—ä¿¡æ¯**ï¼šæŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

**ğŸ‰ æ­å–œï¼æ‚¨çš„ç³»ç»Ÿç°åœ¨å·²ç»å®Œå…¨é›†æˆäº†PassPayï¼Œå…·å¤‡äº†å®Œæ•´çš„æ”¯ä»˜å¤„ç†èƒ½åŠ›ï¼**
